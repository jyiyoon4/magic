<!doctype html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>LocalStorage 응용</title>
    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>

    <!-- jQuery -->
    <script
      src="https://code.jquery.com/jquery-3.7.1.min.js"
      ;
      integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
  </head>

  <body>
    <div class="container">
      <div class="row"></div>
    </div>

    <div class="container">
      <a target="_blank" href="./3-11-1.html">
        <button class="btn btn-danger">장바구니 보기</button>
      </a>
    </div>

    <script>
      var products = [
        { id: 0, price: 12000, title: 'CtrlS 키캡 버튼' },
        { id: 1, price: 4000, title: 'p5.js 포토부스' },
      ];

      var cartItem = [];
      //버튼 눌렀을때 카트 아이템에 먼저 들어가게

      function makeCards(obj) {
        obj.forEach((a) => {
          var newCard = `<div class="col-sm-4">
              <img src="../../assets/product-${a.id}.jpg" class="w-100" />
              <h5>${a.title}</h5>
              <p>가격 : ${a.price}</p>
              <button class="cart">장바구니 추가</button>
            </div>`;
          $('.row').append(newCard);
        });
      }

      makeCards(products);

      var obj = { key: 'value' };
      var newobj = JSON.stringify(obj);
      localStorage.setItem('key', newobj);

      // cartItem = [
      //   // { title: '제목', count: 0 },
      //   // { title: '제목', count: 0 },
      // ];
      // cartItem.ctrlS++;
      // cartItem.others = 1; //새 key 추가

      $('.cart').on('click', function (e) {
        var title = $(e.target).siblings('h5').html();

        if (localStorage.getItem('cart') == null) {
          cartItem.push({ name: title, count: 1 });
        } else {
          cartItem = JSON.parse(localStorage('cart'));
          var found = cartItem.find((item) => {
            item.name == title;
          });

          if (found) {
            found.count++;
          } else {
            cartItem.push({ name: title, count: 1 });
          }
        }
        localStorage.setItem('cart', JSON.stringify(cartItem));
      });
    </script>
  </body>
</html>
