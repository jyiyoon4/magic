<!doctype html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Local Storage</title>
    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>

    <!-- jQuery -->
    <script
      src="https://code.jquery.com/jquery-3.7.1.min.js"
      ;
      integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
  </head>

  <body>
    <div class="container">
      <table class="table table-striped">
        <thead>
          <tr>
            <th id="grade">학년</th>
            <th id="title">강의명</th>
            <th id="professor">교수명</th>
            <th></th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <div class="container">
      <a target="_blank" href="./3-10-1.html">
        <button class="btn btn-danger">장바구니 보기</button>
      </a>
    </div>

    <script>
      var lectures = [];

      $.when(
        $.get('https://jaehun-kang.github.io/MRS_JS_Lecture/lectures.json'),
        $.get('https://jaehun-kang.github.io/MRS_JS_Lecture/more1.json'),
        $.get('https://jaehun-kang.github.io/MRS_JS_Lecture/more2.json'),
      ).done(function (grade2, grade3, grade4) {
        lectures = [...grade2[0], ...grade3[0], ...grade4[0]];
        displayTable();
      });

      function displayTable() {
        var tableContent = '';
        lectures.forEach(function (lecture) {
          tableContent += `<tr>
        <td>${lecture.grade}</td>
        <td>${lecture.title}</td>
        <td>${lecture.professor}</td>
        <td>
          <button class="cart">장바구니 추가</button>
        </td>
      </tr>`;
        });
        $('tbody').html(tableContent);
      }

      localStorage.setItem('name', '가나다');
      localStorage.setItem('age', 111);
      var name = localStorage.getItem('name');
      console.log(name);
      localStorage.removeItem('name');
      // localStorage.clear();

      var arr = ['정지윤', 22, '상명대'];
      localStorage.setItem('profile', arr);
      console.log(localStorage.getItem('profile'));
      var newarr = JSON.stringify(arr);
      console.log(newarr);

      localStorage.setItem('profile2', newarr);
      var load = JSON.parse(localStorage.getItem('profile2'));
      console.log(load);

      setTimeout(() => {
        $('.cart').on('click', function (e) {
          console.log($(this).parent().siblings('td').eq(1).text());

          // localStorage.setItem(
          //   'lecture',
          //   $(this).parent().siblings('td').eq(1).text(),
          // );

          if (localStorage.getItem('lectures') != null) {
            if (
              JSON.parse(localStorage.getItem('lectures')).includes(
                $(this).parent().siblings().eq(1).text(),
              )
            ) {
              return;
            }
            var pull = JSON.parse(localStorage.getItem('lectures'));
            pull.push($(this).parent().siblings().eq(1).text());
            localStorage.setItem('lectures', JSON.stringify(pull));
          } else {
            var newArr = [];
            newArr.push($(this).parent().siblings().eq(1).text());
            localStorage.setItem('lectures', JSON.stringify(newArr));
          }
        });
      }, 300);

    </script>
  </body>
</html>
